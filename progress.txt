# Ralph Progress Log
# Project: Coach Portal MVP
# Location: /Users/wavescapital/hybrid-base-coach-portal
# Started: Thu Jan 29 14:40:08 EST 2026
#
# This file is generated and maintained by Ralph.
# See: https://github.com/thecgaigroup/ralph-cc-loop
---

## Codebase Patterns
- Expo SDK 54 with Expo Router v6 (file-based routing in app/ directory)
- Entry point is `expo-router/entry` in package.json (not App.tsx)
- Dark theme default: background=#0A0A0A, text=#F5FAFF, muted=#8D9299
- Test coach ID: `test-coach-uuid-0001` from lib/testCoach.ts
- Supabase project ID: uevqwbdumouoghymcqtc
- Backend URL: https://api.hybridbase.app
- Quality checks: `npx tsc --noEmit`, `npx expo lint`, `npx expo export --platform web`
- ESLint 9 with eslint-config-expo flat config
- When initializing Expo in non-empty dir, use temp dir and copy files over
- Supabase migrations live in `supabase/migrations/` with numeric prefixes (001_, 002_, etc.)
- Use `IF NOT EXISTS` / `ON CONFLICT DO NOTHING` for idempotent migrations
- Test coach user_id is `00000000-0000-0000-0000-000000000001` (dummy UUID for MVP)

---

## [Iteration 1] 2026-01-29 - US-001
- Initialized Expo project with TypeScript blank template (SDK 54)
- Installed: expo-router, react-dom, react-native-web, @expo/metro-runtime, framer-motion, zustand, @supabase/supabase-js
- Created folder structure: app/, components/, lib/, state/, types/
- Set up Expo Router with file-based routing (app/_layout.tsx, app/index.tsx)
- Created lib/supabase.ts (typed Supabase client) and lib/testCoach.ts (TEST_COACH_ID constant)
- Created .env.local and .env.example with required env vars
- Configured app.json with dark theme, web bundler: metro, scheme: coach-portal
- Files changed: package.json, app.json, tsconfig.json, eslint.config.js, app/_layout.tsx, app/index.tsx, lib/supabase.ts, lib/testCoach.ts, .env.local, .env.example, .gitignore
- **Learnings for future iterations:**
  - `npx create-expo-app` won't run in a non-empty directory; use temp dir + copy
  - ESLint auto-installs on first `npx expo lint` run (creates eslint.config.js)
  - Empty directories cause lint errors - ensure directories have files before linting
  - `expo-router/entry` must be set as "main" in package.json for routing to work
---

## [Iteration 2] 2026-01-29 - US-002
- Created Supabase migrations for coaches and coach_programs tables
- coaches table: id, user_id, display_name, slug, bio, profile_photo_url, social_links, verification_status, created_at
- coach_programs table: id, coach_id, title, slug, description, duration_weeks, difficulty, focus, equipment, template_data, source_pdf_url, status, created_at
- Added auto-created columns to exercises table (is_auto_created, auto_created_by, auto_created_at) with IF NOT EXISTS guards
- RLS policies: coaches read/write own data, public read published programs and verified coaches
- Seeded test coach (test-coach-uuid-0001, display_name "Test Coach", slug "test-coach")
- Files changed: supabase/migrations/001_coaches_table.sql, 002_coach_programs_table.sql, 003_exercises_auto_created.sql, 004_seed_test_coach.sql, prd.json
- **Learnings for future iterations:**
  - SQL migrations don't affect TypeScript checks - `npx tsc --noEmit` and lint still pass
  - Empty directories (components/, state/, types/) cause `npx expo lint` to fail with "no files matching pattern" - run lint on specific directories with files instead
  - Use DO $$ blocks for conditional ALTER TABLE to make migrations idempotent
  - coach_programs has UNIQUE(coach_id, slug) constraint - must handle slug collisions in app code
---

## [Iteration 3] 2026-01-29 - US-002B
- Created Supabase Storage migration (005_storage_buckets.sql) for coach-pdfs and coach-photos buckets
- coach-pdfs: private bucket, 50MB limit, coaches can only access their own folder (by auth.uid)
- coach-photos: public bucket, 5MB limit, publicly readable, coaches manage their own folder
- Storage policies use storage.foldername(name)[1] = auth.uid()::text for folder-based access control
- Created lib/storage.ts with uploadPDF and uploadProfilePhoto helper functions
- Both helpers use timestamp-prefixed filenames to prevent collisions
- Files changed: supabase/migrations/005_storage_buckets.sql, lib/storage.ts, prd.json
- **Learnings for future iterations:**
  - Supabase Storage buckets are created via INSERT INTO storage.buckets, not DDL
  - Use ON CONFLICT (id) DO NOTHING for idempotent bucket creation
  - Storage policies go on storage.objects table, not on the bucket itself
  - storage.foldername(name) returns array of folder segments - use [1] for top-level folder
  - coach-pdfs is private (no public URL works without signed URL in production), but getPublicUrl still returns a URL string for storage reference
---
